opForge 8085 Assembler v1.0
ADDR    BYTES                    LINE  SOURCE
------  -----------------------  ----  ------
----                                1  ; 65816 runtime state assumptions (.assume)
----                                2  ; Demonstrates explicit E/M/X/DBR/DP assumptions and inferred PBR.
----                                3  
----                                4          .cpu 65816
----    EQU 123400                  5          .org $123400
----                                6  
----                                7  start:
----                                8          .assume e=native, m=16, x=16, dp=$2000
----                                9          .assume pbr=$12, dbr=$00 ; explicit mismatch
123400  4B                         10          phk
123401  EA                         11          nop                     ; stack-neutral: does not clear pending PHK bank source
123402  AB                         12          plb                     ; PHK/PLB infers DBR from explicit PBR
----                               13          .assume pbr=$00        ; override
----                               14          .assume pbr=auto       ; restore inferred PBR from current .org bank
----                               15  
123403  A9 34 12                   16          lda #$1234          ; A9 34 12 (A is 16-bit)
123406  A2 78 56                   17          ldx #$5678          ; A2 78 56 (X is 16-bit)
123409  AF 56 34 12                18          lda $123456         ; AD 56 34 (DBR inferred from PHK/PLB + explicit PBR)
----                               19          .assume m=8         ; keep the next A immediate as a single-byte bank value
12340D  A9 12                      20          lda #$12
12340F  48                         21          pha
123410  AB                         22          plb                 ; LDA #imm + PHA + PLB infers DBR from the pushed byte
123411  AF 56 34 12                23          lda $123456         ; AD 56 34
----                               24          .assume dbr=$12     ; known explicit DBR
123415  48                         25          pha                 ; unknown stack source for PLB inference
123416  AB                         26          plb                 ; DBR becomes unknown (no PHK/PHB pending source)
123417  AF 56 34 12                27          lda $123456         ; AF 56 34 12 (unknown DBR prefers long-capable form)
12341B  A5 F0                      28          lda $20F0           ; A5 F0 (DP assumption maps absolute address to direct-page offset)
12341D  4C 10 32                   29          jmp $123210         ; 4C 10 32 (PBR defaults to current .org bank $12)
----                               30  
123420  E2 20                      31          sep #$20            ; A back to 8-bit
123422  A9 9A                      32          lda #$9A            ; A9 9A
----                               33  
----                               34          .assume e=emulation ; forces A/X to 8-bit
123424  A2 BC                      35          ldx #$BC            ; A2 BC
----                               36  
123426  60                         37          rts
----                               38  
----                               39          .end

Lines: 39  Errors: 0  Warnings: 0

SYMBOL TABLE

start           : 123400 (1192960)

Total memory is 39 bytes

GENERATED OUTPUT

ADDR    BYTES
------  -----------------------
123400    4B EA AB A9 34 12 A2 78 56 AF 56 34 12 A9 12 48
123410    AB AF 56 34 12 48 AB AF 56 34 12 A5 F0 4C 10 32
123420    E2 20 A9 9A A2 BC 60
